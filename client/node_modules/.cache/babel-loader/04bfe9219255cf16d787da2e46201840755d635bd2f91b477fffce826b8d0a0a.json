{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useAuth}from'../context/AuthContext';import axios from'axios';import io from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io('http://localhost:5000');const Chat=_ref=>{let{recipientId,recipientName}=_ref;const{user}=useAuth();const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[loading,setLoading]=useState(true);const messagesEndRef=useRef(null);// Generate room ID based on user IDs (sorted to ensure consistency)\nconst roomId=[user._id,recipientId].sort().join('-');useEffect(()=>{// Join room\nsocket.emit('join-room',roomId);// Load message history\nfetchMessages();// Listen for new messages\nsocket.on('receive-message',message=>{if(message.roomId===roomId){setMessages(prev=>[...prev,message]);}});return()=>{socket.off('receive-message');};},[roomId]);useEffect(()=>{scrollToBottom();},[messages]);const fetchMessages=async()=>{try{const res=await axios.get(\"/api/messages/room/\".concat(roomId));setMessages(res.data.data);}catch(error){console.error('Error fetching messages:',error);}finally{setLoading(false);}};const sendMessage=async e=>{e.preventDefault();if(!newMessage.trim())return;try{// Save to database\nconst res=await axios.post('/api/messages',{roomId,message:newMessage});// Add message to local state immediately for the sender\nsetMessages(prev=>[...prev,res.data.data]);// Emit to socket for other users in the room\nsocket.emit('send-message',res.data.data);setNewMessage('');}catch(error){console.error('Error sending message:',error);}};const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow rounded-lg overflow-hidden\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-600 px-6 py-4\",children:/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-white\",children:[\"Chat with \",recipientName]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"h-96 overflow-y-auto p-4 space-y-4\",children:[messages.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-gray-500\",children:\"No messages yet. Start the conversation!\"}):messages.map(message=>/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(message.sender._id===user._id?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-xs lg:max-w-md px-4 py-2 rounded-lg \".concat(message.sender._id===user._id?'bg-blue-600 text-white':'bg-gray-200 text-gray-900'),children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:message.message}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs mt-1 \".concat(message.sender._id===user._id?'text-blue-100':'text-gray-500'),children:new Date(message.createdAt).toLocaleTimeString()})]})},message._id)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border-t px-4 py-4\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:sendMessage,className:\"flex space-x-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newMessage,onChange:e=>setNewMessage(e.target.value),placeholder:\"Type your message...\",className:\"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\",children:\"Send\"})]})})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useRef","useAuth","axios","io","jsx","_jsx","jsxs","_jsxs","socket","Chat","_ref","recipientId","recipientName","user","messages","setMessages","newMessage","setNewMessage","loading","setLoading","messagesEndRef","roomId","_id","sort","join","emit","fetchMessages","on","message","prev","off","scrollToBottom","res","get","concat","data","error","console","sendMessage","e","preventDefault","trim","post","_messagesEndRef$curre","current","scrollIntoView","behavior","className","children","length","map","sender","Date","createdAt","toLocaleTimeString","ref","onSubmit","type","value","onChange","target","placeholder"],"sources":["C:/Users/bnaz1/Desktop/devconnect/client/src/components/Chat.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport axios from 'axios';\r\nimport io from 'socket.io-client';\r\n\r\nconst socket = io('http://localhost:5000');\r\n\r\nconst Chat = ({ recipientId, recipientName }) => {\r\n  const { user } = useAuth();\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const messagesEndRef = useRef(null);\r\n\r\n  // Generate room ID based on user IDs (sorted to ensure consistency)\r\n  const roomId = [user._id, recipientId].sort().join('-');\r\n\r\n  useEffect(() => {\r\n    // Join room\r\n    socket.emit('join-room', roomId);\r\n\r\n    // Load message history\r\n    fetchMessages();\r\n\r\n    // Listen for new messages\r\n    socket.on('receive-message', (message) => {\r\n      if (message.roomId === roomId) {\r\n        setMessages(prev => [...prev, message]);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      socket.off('receive-message');\r\n    };\r\n  }, [roomId]);\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  const fetchMessages = async () => {\r\n    try {\r\n      const res = await axios.get(`/api/messages/room/${roomId}`);\r\n      setMessages(res.data.data);\r\n    } catch (error) {\r\n      console.error('Error fetching messages:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const sendMessage = async (e) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim()) return;\r\n\r\n    try {\r\n      // Save to database\r\n      const res = await axios.post('/api/messages', {\r\n        roomId,\r\n        message: newMessage\r\n      });\r\n\r\n      // Add message to local state immediately for the sender\r\n      setMessages(prev => [...prev, res.data.data]);\r\n\r\n      // Emit to socket for other users in the room\r\n      socket.emit('send-message', res.data.data);\r\n\r\n      setNewMessage('');\r\n    } catch (error) {\r\n      console.error('Error sending message:', error);\r\n    }\r\n  };\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-64\">\r\n        <div className=\"loading-spinner\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white shadow rounded-lg overflow-hidden\">\r\n      {/* Chat Header */}\r\n      <div className=\"bg-blue-600 px-6 py-4\">\r\n        <h3 className=\"text-lg font-semibold text-white\">\r\n          Chat with {recipientName}\r\n        </h3>\r\n      </div>\r\n\r\n      {/* Messages */}\r\n      <div className=\"h-96 overflow-y-auto p-4 space-y-4\">\r\n        {messages.length === 0 ? (\r\n          <div className=\"text-center text-gray-500\">\r\n            No messages yet. Start the conversation!\r\n          </div>\r\n        ) : (\r\n          messages.map((message) => (\r\n            <div\r\n              key={message._id}\r\n              className={`flex ${message.sender._id === user._id ? 'justify-end' : 'justify-start'}`}\r\n            >\r\n              <div\r\n                className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${\r\n                  message.sender._id === user._id\r\n                    ? 'bg-blue-600 text-white'\r\n                    : 'bg-gray-200 text-gray-900'\r\n                }`}\r\n              >\r\n                <p className=\"text-sm\">{message.message}</p>\r\n                <p className={`text-xs mt-1 ${\r\n                  message.sender._id === user._id ? 'text-blue-100' : 'text-gray-500'\r\n                }`}>\r\n                  {new Date(message.createdAt).toLocaleTimeString()}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      {/* Message Input */}\r\n      <div className=\"border-t px-4 py-4\">\r\n        <form onSubmit={sendMessage} className=\"flex space-x-4\">\r\n          <input\r\n            type=\"text\"\r\n            value={newMessage}\r\n            onChange={(e) => setNewMessage(e.target.value)}\r\n            placeholder=\"Type your message...\"\r\n            className=\"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\r\n          />\r\n          <button\r\n            type=\"submit\"\r\n            className=\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\"\r\n          >\r\n            Send\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chat;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}